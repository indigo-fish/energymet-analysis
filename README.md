## Description
This project looks at the weather conditions associated with the highest electricity prices. The project requires a netCDF file with the outputs of an electricity network as generated by pypsa-usa. The repository finds the highest price hours in the electricity network, downloads ERA5 data for the corresponding days, and processing energy-related metrics from the ERA5 data. The results are visualized through various plots to aid in understanding trends within the electricity market and weather impacts.

## Structure Overview

The repository consists of the directories:
- **analysis_code/**: All Python scripts other than **launch_analysis.py**.
- **DATA/**: Includes a link to a compressed version of the sample netCDF electricity network output. This folder should be downloaded and extracted to this folder in the user's repository, or another `pypsa-usa` electricity network netCDF output provided.
- **Figures/**: Used to store subfolder of plots for each run name analysed. By default includes plots of the sample network.
- **TEMP_OUTPUTS/**: Will create a subfolder of intermediate output files (e.g. highest electricity price hours, ERA5 downloads) for each run analysed. By default includes these intermediate outputs for the sample network.

### Code

1. **launch_analysis.py**: This is the main script that triggers the entire analysis process by calling the respective scripts in the **analysis_code/** folder to analyse electricity data, download ERA5 data, and process it. The user should update the `RUN_NAME` before launching this script.
2. **analysis_code/read_electricity_network.py**: This module reads and analyses electricity network data from the named netCDF file. It calculates mean hourly prices, identifies periods of high pricing, and visualises electricity generation by carrier.
3. **analysis_code/download_era5_data.py**: This module contains functions for downloading ERA5 climate data using the CDS API. It loads the dates identified in the previous scripts, downloads the data for a set of relevant variables, and unzips the files for further processing.
4. **analysis_code/process_era5_data.py**: This module contains functions used to process the downloaded ERA5 climate data, including loading datasets, plotting the data, and saving visualizations to specified folders.

## Requirements
Ensure you have the following Python libraries installed:
- `xarray`
- `pandas`
- `numpy`
- `matplotlib`
- `cartopy`
- `cdsapi`

## Setup
1. Clone the repository:
   ```
   bash
   git clone <repository_url>
   cd <repository_directory>
   ```

2. Install the required packages:
   ```
   pip install -r requirements.txt
   ```

4. Set up your CDS API Key to access ERA5 data by creating a file named '.cdsapirc' in your home directory (see [CDSAPI setup](https://cds.climate.copernicus.eu/how-to-api) for details).

5. Include the desired `pypsa-usa` run name in the **DATA/** folder and update the `RUN_NAME` in **launch_analysis.py**.

## Usage
Run the main analysis script to initiate the entire analysis workflow:
```
python launch_analysis.py
```
It will:
- Analyse electricity network data.
- Download the relevant ERA5 data for the specified time period.
- Process and visualise the downloaded data.

## Output
The outputs of the analysis will be saved in the **Figures/** directory, and CSV files containing the highest pricing hours will be saved in the **TEMP_OUTPUTS/** directory.
